<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/x-icon" href="https://www.curso-objetivo.br/assets/img/favicon.ico" />
  <title>Painel ‚Ä¢ Simulado ENEM - Reda√ß√£o</title>

  <!-- Materialize -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <!-- Google Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

 <style>
  :root{
  --bg:#f7f8fb; --card:#ffffff; --line:#e9edf3; --ink:#0f172a; --muted:#6b7280;
  --primary:#0b3b78; --primary-light:#1e4b9a; --accent:#2563eb;
  --aside-w:260px; --topbar-h:64px;
}

/* Base */
html,body{height:100%}
body{background:var(--bg); color:var(--ink); font-family:'Roboto',sans-serif}

/* ===== Layout ===== */
.app{display:grid; grid-template-columns:var(--aside-w) 1fr; min-height:100vh}
.aside{background:#fff; border-right:1px solid var(--line)}
.main{display:flex; flex-direction:column}

/* ===== TOPBAR (universal: funciona no painel e no envio) ===== */
header.topbar,
.topbar.blue.darken-3.white-text,
body > .topbar, .app > .topbar, .main > .topbar{
  position:fixed; top:0; left:0; right:0; height:var(--topbar-h); z-index:20;
  background:var(--primary) !important; color:#fff !important;
  display:flex; align-items:center;
  padding:12px 24px; padding-left:calc(var(--aside-w) + 24px);
  box-shadow:0 2px 10px rgba(16,24,40,.12);
}
/* neutraliza o ‚Äúquadro azul interno‚Äù do Materialize quando h√° header */
header.topbar > .topbar{background:transparent !important; box-shadow:none !important}
/* container do topo: largura total + flex */
header.topbar .container,
.topbar.blue.darken-3.white-text .container,
body > .topbar .container, .app > .topbar .container, .main > .topbar .container{
  max-width:none !important; width:100% !important; margin:0 !important; padding:0 !important;
  display:flex; align-items:center; gap:12px;
}
/* t√≠tulo: 1 linha, com retic√™ncias */
header.topbar :is(h1,h2,h3,h4,h5,h6,.title,.m-0),
.topbar.blue.darken-3.white-text :is(h1,h2,h3,h4,h5,h6,.title,.m-0),
body > .topbar :is(h1,h2,h3,h4,h5,h6,.title,.m-0),
.app > .topbar :is(h1,h2,h3,h4,h5,h6,.title,.m-0),
.main > .topbar :is(h1,h2,h3,h4,h5,h6,.title,.m-0){
  margin:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  flex:1 1 auto; min-width:0;
}
/* √°rea da direita (chips/badges) */
header.topbar .top-actions, header.topbar .right,
.topbar.blue.darken-3.white-text .top-actions, .topbar.blue.darken-3.white-text .right,
body > .topbar .top-actions, .app > .topbar .top-actions, .main > .topbar .top-actions{
  margin-left:auto;
}
/* conte√∫do desce para n√£o ficar sob o topo */
main, .main{padding-top:calc(var(--topbar-h) + 8px)}

/* ===== Sidebar fixa/rol√°vel abaixo do topo ===== */
aside{
  position:sticky; top:var(--topbar-h);
  height:calc(100vh - var(--topbar-h));
  overflow:auto; align-self:start; z-index:6;
  background:#fff; border-right:1px solid var(--line);
}

/* ===== Menu ===== */
.menu a{
  position:relative; display:flex; align-items:center; gap:12px;
  padding:12px 18px; margin:6px 12px; color:#111827; border-radius:10px; font-weight:600;
  background:transparent; box-shadow:none; border-left:0;
}
.menu a::before, .menu a::after{content:none !important}
.menu a, .menu a:focus, .menu a:active{background:transparent !important; box-shadow:none !important; border-left:0 !important}
.menu a:hover{background:var(--primary-light); color:#fff}
.menu li.active a, .menu a.active{background:#e7efff !important; color:var(--primary) !important}

/* ===== Content ===== */
.content{max-width:1200px; margin:0 auto; padding:20px}

/* ===== Cards ===== */
.card{background:var(--card); border:1px solid var(--line); border-radius:8px; padding:20px}
.card h2,.card h3{color:var(--primary)}
.card.edge{border-radius:14px; border:1px solid var(--line)}
.kpi .card-content{padding:22px}
.kpi .value{font-size:2.1rem; font-weight:800}
.kpi .label{color:var(--muted); margin-top:4px}
.action .card-content{text-align:center; padding:26px}
.action .material-icons{font-size:50px; color:var(--primary); opacity:.95}
.action .title{margin-top:10px; font-weight:800; font-size:1.5rem}
.small-actions .card .card-content{padding:16px; text-align:center}

/* ===== Bot√µes ===== */
.btn,.btn-primary{background:var(--primary) !important; color:#fff !important}
.btn:hover,.btn-primary:hover{background:var(--primary-light) !important}
.btn-secondary{background:#e0e0e0; color:var(--ink)}
.btn-danger{background:transparent; color:#d32f2f}

/* ===== Responsivo ===== */
@media (max-width:992px){
  .app{grid-template-columns:1fr}
  /* no mobile, o topo n√£o precisa ‚Äúreservar‚Äù o espa√ßo do aside */
  header.topbar,
  .topbar.blue.darken-3.white-text,
  body > .topbar, .app > .topbar, .main > .topbar{
    padding-left:16px;
  }
  aside{display:none} /* remova se quiser manter o menu no mobile */
}
</style>


</head>
<body>
  <div class="app">
    <!-- ===== Aside / Menu ===== -->
    <aside class="aside">
      <div class="logo">
        <div class="tick"><i class="material-icons" style="font-size:18px">check</i></div>
        <div style="font-weight:800">Reda√ß√£o Online</div>
      </div>
      <nav class="menu">
        <a class="active" href="#"><i class="material-icons">dashboard</i>Dashboard</a>
        <a href="envio.html"><i class="material-icons">description</i>Envio de Reda√ß√µes</a>
        <a href="professores.html"><i class="material-icons">group</i>Professores</a>
        <a href="relatorios.html"><i class="material-icons">insert_chart_outlined</i>Relat√≥rios</a>
        <a href="config.html"><i class="material-icons">settings</i>Configura√ß√µes</a>
      </nav>
    </aside>

    <!-- ===== Main ===== -->
    <section class="main">
      <!-- Header -->
      <div class="topbar">
        <div class="wrap">
          <div class="row valign-wrapper" style="margin-bottom:0">
            <div class="col s12 m6 left-align">
              <span class="brand">Reda√ß√£o Online</span>
              <span class="unit">‚Ä¢ <span id="unitIdName">‚Äî</span></span>
            </div>
            <div class="col s12 m6 right-align">
              <span class="user-chip"><i class="material-icons left">account_circle</i><span id="userName">Usu√°rio</span></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="content">
        <!-- üî¥ seletor removido -->

        <!-- KPIs (apenas Enviadas e Corretores) -->
        <div class="row" style="margin-bottom:10px">
          <div class="col s12 m6">
            <div class="card edge kpi z-depth-0">
              <div class="card-content center">
                <div class="value" id="kpiEnviadas">‚Äî</div>
                <div class="label">Reda√ß√µes enviadas</div>
              </div>
            </div>
          </div>
          <div class="col s12 m6">
            <div class="card edge kpi z-depth-0">
              <div class="card-content center">
                <div class="value" id="kpiCorretores">‚Äî</div>
                <div class="label">Corretores</div>
              </div>
            </div>
          </div>
        </div>

        <!-- A√ß√µes (3 m√©dios: Enviar, Corretores, Conferir envio) -->
        <div class="row">
          <div class="col s12 m4">
            <div class="card edge action hoverable">
              <div class="card-content">
                <i class="material-icons">cloud_upload</i>
                <div class="title">Enviar reda√ß√£o</div>
                <p class="grey-text">Imagens ou PDF ‚Ä¢ Lote permitido</p>
              </div>
              <div class="card-action center">
                <a href="envio.html" class="btn waves-effect waves-light blue darken-2"><i class="material-icons left">arrow_forward</i>Abrir envio</a>
              </div>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="card edge action hoverable">
              <div class="card-content">
                <i class="material-icons">face</i>
                <div class="title">Corretores</div>
                <p class="grey-text">Gerencie professores da unidade</p>
              </div>
              <div class="card-action center">
                <a href="professores.html" class="btn-flat">Abrir</a>
              </div>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="card edge action hoverable">
              <div class="card-content">
                <i class="material-icons">search</i>
                <div class="title">Conferir envio</div>
                <p class="grey-text">Validar inscri√ß√£o manualmente</p>
              </div>
              <div class="card-action center">
                <a href="conferir-envio.html" class="btn-flat">Abrir</a>
              </div>
            </div>
          </div>
        </div>

        <!-- A√ß√µes menores (opcionais) -->
        <div class="row small-actions">
          <div class="col s12 m4">
            <div class="card edge z-depth-0 hoverable">
              <div class="card-content">
                <i class="material-icons">east</i>
                <div style="font-weight:700">Enviar reda√ß√£o</div>
              </div>
            </div>
          </div>
          <div class="col s12 m4">
            <div class="card edge z-depth-0 hoverable">
              <div class="card-content">
                <i class="material-icons">badge</i>
                <div style="font-weight:700">Cadastrar professor</div>
              </div>
            </div>
          </div>
          <div class="col s12 m4">
            <div class="card edge z-depth-0 hoverable">
              <div class="card-content">
                <i class="material-icons">settings</i>
                <div style="font-weight:700">Configurar unidade</div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>
  </div>

<script>
/* ===== CONFIG ===== */
const API = 'https://api.secauxiliar.com.br/';
const LOGIN_URL = '/redacaoeenem/login.html';
const SESS_KEY = 'sessao_redacao';

/* ===== Sess√£o ===== */
function getSession(){
  try { return JSON.parse(localStorage.getItem(SESS_KEY) || '{}'); }
  catch(e){ return {}; }
}
function setSession(sess){
  localStorage.setItem(SESS_KEY, JSON.stringify(sess || {}));
}
function getToken(){
  const sess = getSession();
  return (sess && sess.token) || localStorage.getItem('token') || '';
}
function authHeaders(){
  const t = getToken();
  return t ? { 'Authorization': `Bearer ${t}` } : {};
}
function redirectToLogin(){
  const next = encodeURIComponent(location.pathname + location.search + location.hash);
  location.replace(`${LOGIN_URL}?next=${next}`);
}

/* ===== Fetch helper (com fallback .php) ===== */
async function apiFetch(pathNoPhp, { method='GET', headers={}, body, cache='no-store' } = {}){
  const baseHeaders = { 'Accept': 'application/json', ...authHeaders(), ...headers };
  const opts = { method, cache, headers: baseHeaders, body };

  let res;
  try { res = await fetch(`${API}${pathNoPhp}`, opts); } catch(e){ res = null; }

  // fallback .php
  if (!res || res.status === 404) {
    const withPhp = pathNoPhp.endsWith('.php') ? pathNoPhp : pathNoPhp + '.php';
    try { res = await fetch(`${API}${withPhp}`, opts); } catch(e){ /* ignore */ }
  }

  if (!res) throw new Error('NETWORK_FAIL');
  if (res.status === 401 || res.status === 403) throw new Error('UNAUTHORIZED');
  if (!res.ok) {
    const txt = await res.text().catch(()=> '');
    throw new Error(`API_${res.status}: ${txt || res.statusText}`);
  }
  return res.json();
}

/* ===== UI helpers ===== */
function setUnitHeader({ codigo, nome } = {}){
  const el = document.getElementById('unitIdName');
  if(!el) return;
  if(codigo && nome) el.textContent = `${codigo} - ${nome}`;
  else if(nome)      el.textContent = nome;
  else               el.textContent = '‚Äî';
}
function setUserName(nome){
  const el = document.getElementById('userName');
  if (el && nome) el.textContent = nome;
}

/* ===== Boot ===== */
document.addEventListener('DOMContentLoaded', initPainel);

async function initPainel(){
  try{
    if (!getToken()) return redirectToLogin();

    const sess = getSession();
    if (sess?.unidade?.codigo && sess?.unidade?.nome) {
      setUnitHeader(sess.unidade);
      setUserName(sess?.usuario?.nome);
    } else {
      await carregarContextoDaAPI();
    }

    // üî¥ Sem simulados/KPIs por simulado neste momento
    document.body.classList.add('ready');
  } catch(err){
    console.error('Falha na inicializa√ß√£o:', err);
    if (String(err.message).includes('UNAUTHORIZED')) return redirectToLogin();
  }
}

/* ===== Contexto (/me) ===== */
async function carregarContextoDaAPI(){
  try{
    // chama o endpoint real que voc√™ tem no servidor
    const data = await apiFetch('/auth_me.php'); 
    if (data?.usuario?.nome) setUserName(data.usuario.nome);
    if (data?.unidade) setUnitHeader(data.unidade);

    const merged = { ...getSession(), ...data };
    setSession(merged);
  }catch(e){
    console.warn('Falha ao carregar contexto da API', e);
    if (String(e.message).includes('UNAUTHORIZED')) redirectToLogin();
  }
}


/* ===== KPIs (mantidos apenas para futura liga√ß√£o; hoje ficam em "‚Äî") ===== */
function setKPIs({ enviadas='‚Äî', corretores='‚Äî', unidade, usuario } = {}){
  const elEnv = document.getElementById('kpiEnviadas');
  const elCor = document.getElementById('kpiCorretores');
  if (elEnv) elEnv.textContent = enviadas;
  if (elCor) elCor.textContent = corretores;
  if (unidade?.codigo && unidade?.nome) setUnitHeader(unidade);
  if (usuario?.nome) setUserName(usuario.nome);
}

/* ===== Bloqueio de cliques at√© ready (opcional) ===== */
document.addEventListener('click', (ev) => {
  if (!document.body.classList.contains('ready')) {
    const target = ev.target.closest('a,button');
    if (target) { ev.preventDefault(); ev.stopPropagation(); }
  }
});
</script>
</body>
</html>
