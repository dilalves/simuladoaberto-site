<!doctype html>
<html lang="pt-br">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/x-icon" href="https://www.curso-objetivo.br/assets/img/favicon.ico" />
<title>Login — Redação ENEM</title>
<style>
  :root{
      --bg:#f7f8fb; --card:#ffffff; --line:#e9edf3; --ink:#0f172a; --muted:#6b7280; --primary:#0b3b78; --accent:#2563eb;
      --aside-w: 260px;       /* largura do menu lateral */
      --topbar-h: 64px;       /* altura do topo */
    }

    header.topbar{
      position: fixed; top: 0; left: 0; right: 0; height: var(--topbar-h); z-index: 20;
      background: var(--primary); color:#fff; display:flex; align-items:center;
      padding: 12px 24px; padding-left: 0; box-shadow:0 2px 10px rgba(16,24,40,.12);
    }
    header.topbar > .topbar{ background: transparent !important; box-shadow: none !important; }
    header.topbar .container{ max-width: none; width: 100%; margin: 0; padding: 0; }
    header.topbar h5{ margin: 0; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  body{font-family:system-ui,Arial;padding:24px;background:#f6f7fb}
  .card{max-width:420px;margin:56px auto;background:#fff;border-radius:12px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
  /* inputs continuam largos */
  input{
    width:95%;
    padding:12px;
    border-radius:8px;
    border:1px solid #ddd;
    margin-top:8px;
  }

  /* botão menor e centralizado */
  #btn{
    width:160px;            /* ajuste o tamanho aqui */
    padding:12px 16px;
    border-radius:8px;
    display:block;
    margin:12px auto 0;     /* centraliza */
    border:none;
    background:#0d6efd;
    color:#fff;
    cursor:pointer;
  }
  #btn:hover{ filter: brightness(1.03); }
  #btn:disabled{ opacity:.6; cursor:default; }
  button{background:#0d6efd;border:none;color:#fff;cursor:pointer}
  .msg{margin-top:12px;color:#b00}
</style>

<body>
    <header class="topbar">
      <div class="topbar blue darken-3 white-text"
          style="display:flex; align-items:center; justify-content:space-between; padding:0 24px; width:100%;">
        
        <!-- Bloco ESQUERDA -->
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="/redacaoenem/logo-mini.png" alt="Logo" style="height:28px; width:auto; margin-left:8px;">
          <h5 class="m-0" style="margin:0; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis">
            Simulado Aberto ENEM - Redação
          </h5>
        </div>
      </div>
    </header>

  <div class="card">
    <h2>Redação ENEM — Acesso</h2>
    <input id="login" placeholder="Login da unidade (ex.: 8529)" inputmode="numeric">
    <input id="senha" type="password" placeholder="Senha">
    <button id="btn">Entrar</button>
    <div id="msg" class="msg"></div>
  </div>

<script>
// === CONFIG ===
const STORAGE_KEY = 'sessao_redacao';      // onde você guarda o JSON da sessão
const MAX_IDLE_MS = 30 * 60 * 1000;        // 30 min de inatividade
const MAX_TTL_MS  = 2  * 60 * 60 * 1000;   // 2 horas de sessão total

// === STORAGE WRAPPER (prefere sessionStorage, faz fallback p/ localStorage) ===
const S = {
  get raw() { return sessionStorage.getItem(STORAGE_KEY) || localStorage.getItem(STORAGE_KEY); },
  set raw(v) { try { sessionStorage.setItem(STORAGE_KEY, v); localStorage.removeItem(STORAGE_KEY); } catch(e) { localStorage.setItem(STORAGE_KEY, v); } },
  clear()    { try { sessionStorage.removeItem(STORAGE_KEY); } catch(e){} try { localStorage.removeItem(STORAGE_KEY); } catch(e){} }
};

// === CRIA/ATUALIZA A SESSÃO COM METADADOS ===
function createOrRefreshSession(payload) {
  const now = Date.now();
  let sess = readSession();
  if (!sess) {
    sess = {
      data: payload || {},          // ex.: { unidade: { codigo: "1501", ... }, login: "1501" }
      createdAt: now,
      lastActiveAt: now,
      expiresAt: now + MAX_TTL_MS
    };
  } else {
    sess.lastActiveAt = now;
  }
  S.raw = JSON.stringify(sess);
  return sess;
}

// === LÊ/VALIDA A SESSÃO (checa TTL e inatividade) ===
function readSession() {
  if (!S.raw) return null;
  try {
    const sess = JSON.parse(S.raw);
    const now  = Date.now();
    if (!sess.createdAt || !sess.lastActiveAt || !sess.expiresAt) throw new Error('meta ausente');
    const idleOk = (now - sess.lastActiveAt) <= MAX_IDLE_MS;
    const ttlOk  = now <= sess.expiresAt;
    if (!idleOk || !ttlOk) {
      S.clear();
      return null;
    }
    return sess;
  } catch {
    S.clear();
    return null;
  }
}

// === LOGOUT/FINALIZAÇÃO ===
function hardLogout(redirectToLogin = true) {
  S.clear();
  try { localStorage.removeItem('last_login'); } catch(e){}
  if (redirectToLogin) location.href = '/redacaoenem/index.html';
}

// === HEARTBEAT DE ATIVIDADE ===
let _idleTimer = null;
function bumpActivity() {
  const sess = readSession();
  if (!sess) return;
  sess.lastActiveAt = Date.now();
  S.raw = JSON.stringify(sess);
  if (_idleTimer) clearTimeout(_idleTimer);
  _idleTimer = setTimeout(() => hardLogout(true), MAX_IDLE_MS + 5000);
}
['click','keydown','mousemove','touchstart','scroll'].forEach(evt =>
  window.addEventListener(evt, bumpActivity, { passive: true })
);

// === LIMPESA AO SAIR/OCULTAR ===
// pagehide funciona melhor no mobile/Safari do que beforeunload.
// visibilitychange cobre trocas de aba/app suspenso.
function clearOnExit() { S.clear(); }
window.addEventListener('pagehide', clearOnExit);
window.addEventListener('beforeunload', clearOnExit);
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden') clearOnExit();
});

// === BOOTSTRAP NA CARGA ===
(function bootstrapSession() {
  const sess = readSession();
  if (!sess) {
    // sem sessão válida → força login
    hardLogout(true);
    return;
  }
  // sessão válida → inicia heartbeat
  bumpActivity();
})();

// Exemplo de uso ao logar com sucesso:
// createOrRefreshSession({ unidade: { codigo: '1501' }, login: '1501' });
</script>


</body>
</html>