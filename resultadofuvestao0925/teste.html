<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/x-icon" href="https://www.curso-objetivo.br/assets/img/favicon.ico" />
  <title>Resultado - Simulado Fuvest√£o 2026</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <style>
    header {
      margin:0;
      padding:20px 0;
      background:#002776;
      color:#fff;
      text-align:center;
    }
    body { background:#fafafa; }
    h1 { margin:0; font-size:24px; }
    footer { text-align:center; padding:20px; font-size:14px; color:#adb7ee; }
    .brand { color:#002776; font-weight:600; }
    table.striped th { color:#002776; }
    .acerto { background:#a8d7f7; }
    .erro {
      background:#a8d7f7;
      border-left:4px solid #002776;
    }
    .btn { border-radius:6px; }
    .card { border-radius:10px; }
    #btnTopo {
      position:fixed;
      right:20px;
      bottom:20px;
      background:#002776;
      color:#fff;
      border:none;
      border-radius:50%;
      width:46px;
      height:46px;
      font-size:22px;
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
      display:none;
    }
    #btnTopo:hover {
      background:#0b49a5;
    }
/* -----------  MOBILE FIRST (celular) ----------- */
@media (max-width: 480px) {
  body { background:#fafafa; }

  h1 { font-size:18px; }

  .container { padding:0 10px; }

  .card {
    padding:14px !important;
    margin-bottom:15px;
  }

  .btn {
    width:100%;
    margin-top:6px;
  }

  #dadosAluno {
    padding:14px !important;
    font-size:14px;
  }

  /* === Gr√°fico === */
  #chartWrap {
    width:100%;
    overflow-x:auto;
    overflow-y:hidden;
    -webkit-overflow-scrolling:touch;
    border-radius:6px;
    background:#fff;
    padding:10px 0;
  }
  #chartWrap canvas {
    min-width:800px; /* largura m√≠nima para n√£o cortar disciplinas */
    height:auto !important;
    display:block;
  }

  /* === Tabela de quest√µes === */
  .tabelaWrap {
    overflow-x:auto;
    white-space:nowrap;
  }

  table.striped {
    font-size:12px;
    border-collapse:separate;
    border-spacing:0 4px;
    min-width:600px;
  }

  table.striped th,
  table.striped td {
    text-align:center;
    padding:6px 8px;
  }

  .acerto {
    background:#e8f5e9;
    color:#1b5e20;
    font-weight:600;
  }

  .erro {
    background:#ffebee;
    color:#b71c1c;
    font-weight:600;
  }

  #btnTopo {
    width:40px;
    height:40px;
    font-size:18px;
  }
}


  /* -----------  TABLET (entre 481 e 768px) ----------- */
  @media (min-width: 481px) and (max-width: 768px) {
    h1 {
      font-size:20px;
    }
    .container {
      padding:0 20px;
    }
    .btn {
      width:auto;
    }
    table.striped {
      font-size:13px;
    }
  }

  /* vers√£o desktop: aviso oculto */
  #avisoMobile {
    display: none;
    background: #fff3cd;
    border: 1px solid #ffeeba;
    color: #856404;
    padding: 14px;
    border-radius: 8px;
    font-size: 14px;
    margin-top: 16px;
    text-align: center;
  }

  </style>
</head>

<body>
  <header>
    <h1>Simulado Aberto Fuvest√£o 2026</h1>
  </header>

  <img src="https://raw.githubusercontent.com/dilalves/simuladoaberto-site/main/resultadofuvestao0925/Digital---Simulado-Aberto-728X90.png" 
       alt="Banner Simulado Aberto"
       style="display:block; margin:20px auto; max-width:728px; width:100%;">

  <div class="container">
    <h5 class="brand center">Simulado Fuvest√£o 2026</h5>

    <!-- üîç Formul√°rio de busca -->
    <div class="card z-depth-2" style="padding:20px;">
      <div class="row">
        <div class="input-field col s6">
          <input id="inscricao" type="text">
          <label for="inscricao">Inscri√ß√£o</label>
        </div>
        <div class="input-field col s6">
          <input id="cpf" type="text">
          <label for="cpf">CPF</label>
        </div>
      </div>
      <div class="center">
        <button class="btn waves-effect blue darken-3" onclick="buscarResultado()">Consultar Resultado</button>
      </div>
    </div>

    <!-- üìÑ Dados e gr√°fico -->
    <div id="dadosAluno" class="card white z-depth-1" style="display:none; padding:20px;"></div>

    <!-- üß© Tabela de respostas -->
    <table id="tblRespostas" class="striped centered responsive-table" style="display:none;">
      <thead>
        <tr>
          <th>Quest√£o</th>
          <th>Resposta Aluno</th>
          <th>Gabarito</th>
          <th>Resolu√ß√£o</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  <!-- Modal de Resolu√ß√£o -->
  <div id="modalResolucao" class="modal" style="max-width:95vw;">
    <div class="modal-content center-align" style="padding:10px 0;">
      <h6 class="brand" style="margin-bottom:10px;">Resolu√ß√£o da Quest√£o</h6>
      <div id="areaResolucao" style="padding:0 10px;"></div>
    </div>
    <div class="modal-footer" style="text-align:right;">
      <a href="#!" class="modal-close btn-flat">Fechar</a>
    </div>
  </div>

    <div id="avisoMobile">
      ‚ö†Ô∏è Para visualizar as quest√µes e resolu√ß√µes completas,<br>
        acesse este resultado em um computador ou tablet.
    </div>

    <button id="btnTopo" onclick="window.scrollTo({top:0,behavior:'smooth'})">&#8593;</button>
  </div>

  <!-- ======================== SCRIPTS ======================== -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <script>
  // Inicializa Materialize
  document.addEventListener('DOMContentLoaded', function() {
    const modals = document.querySelectorAll('.modal');
    M.Modal.init(modals);
  });

  // === CONSULTA RESULTADO ===
  async function buscarResultado() {
    const inscricao = document.getElementById("inscricao").value.trim();
    const cpf = document.getElementById("cpf").value.trim();
    const url = `https://api.secauxiliar.com.br/psq_resultado_fuv_0925.php?inscricao=${inscricao}&cpf=${cpf}`;

    try {
      const resp = await fetch(url);
      const dados = await resp.json();

      if (!dados.ok) {
        M.toast({html: dados.msg, classes: 'red'});
        return;
      }

      const aluno = dados.aluno;
      const respostas = dados.respostas;
      const dadosAluno = document.getElementById('dadosAluno');
      const tabela = document.getElementById('tblRespostas');
      const tbody = tabela.querySelector('tbody');

      dadosAluno.innerHTML = `
        <h6><b>${aluno.Nome}</b> ‚Ä¢ ${aluno.Nome_Unidade}</h6>
        <p>Inscri√ß√£o: ${aluno.INSCRICAO} | CPF: ${aluno.CPF}</p>
        <p><b>Acertos:</b> ${dados.acertos}/${dados.total} (${dados.percentual}%)</p>
        <table class="highlight centered">
          <thead>
            <tr><th colspan="13">Desempenho nas √Åreas</th></tr>
            <tr>
              <th>POR</th><th>HIS</th><th>ING</th><th>SOC</th>
              <th>BIO</th><th>QUI</th><th>FIL</th><th>FIS</th>
              <th>MAT</th><th>GEO</th><th>TOTAL</th><th>CLS_G</th><th>CLS_U</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${aluno.POR}</td><td>${aluno.HIS}</td><td>${aluno.ING}</td><td>${aluno.SOC}</td>
              <td>${aluno.BIO}</td><td>${aluno.QUI}</td><td>${aluno.FIL}</td><td>${aluno.FIS}</td>
              <td>${aluno.MAT}</td><td>${aluno.GEO}</td><td><b>${aluno.TOTAL}</b></td>
              <td>${aluno.CLS_G}</td><td>${aluno.CLS_U}</td>
            </tr>
          </tbody>
        </table>
        <canvas id="graficoDesempenho" style="width:100%;max-width:1000px;margin:30px auto;display:block;"></canvas>
      `;
      
      dadosAluno.style.display = 'block';

      tbody.innerHTML = respostas.map(r => {
        const acertou = r.ACERTOU == 1;
        const classe  = acertou ? 'acerto' : 'erro';
        const icone = acertou 
          ? '<span style="color:green;font-weight:bold;font-size:18px;">&#10004;</span>' 
          : `<button class="btn-small blue lighten-1" onclick="abrirModalResolucao('${r.LINK || ''}')">Ver resolu√ß√£o</button>`;
        return `
          <tr class="${classe}">
            <td>${r.QUESTAO_ALUNO}</td>
            <td>${r.RESPOSTA_ALUNO || '-'}</td>
            <td>${r.GABARITO_CORRETO}</td>
            <td>${icone}</td>
          </tr>
        `;
      }).join('');


      

      // === GR√ÅFICO COMPARATIVO ===
      const ctx = document.getElementById('graficoDesempenho');
      if (ctx) {
        const disciplinas = ['POR','HIS','ING','SOC','BIO','QUI','FIL','FIS','MAT','GEO'];
        const notasAluno  = disciplinas.map(d => parseFloat(aluno[d]));
        const medias      = disciplinas.map(d => parseFloat(dados.media_geral[d]));

        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: disciplinas,
            datasets: [
              { label: 'Aluno', data: notasAluno, backgroundColor: '#8AA9E0' },
              { label: 'M√©dia Geral', data: medias, backgroundColor: '#B3C7F3' }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              title: { display: true, text: 'Comparativo por Disciplina', font: { size: 18 } },
              legend: { position: 'bottom' },
              tooltip: { enabled: true },
              datalabels: { color: '#000', anchor: 'end', align: 'start', font: { weight: 'bold', size: 12 } }
            },
            scales: { y: { beginAtZero: true, max: 20, ticks: { stepSize: 2 } } }
          },
          plugins: [ChartDataLabels]
        });
      }

      tabela.style.display = 'table';
    } catch (e) {
      console.error(e);
      M.toast({html:'Erro ao consultar resultado', classes:'red'});
    }
  }

  // === ABRIR MODAL DE RESOLU√á√ÉO ===
  function abrirModalResolucao(link) {
  if (!link) return;

  const match = link.match(/[-\w]{25,}/);
  let id = match ? match[0] : null;
  if (!id) return;

  const urlImagem = `https://lh3.googleusercontent.com/d/${id}=s2000`;
  const urlIframe = `https://drive.google.com/file/d/${id}/preview`;

  const modal = document.getElementById('modalResolucao');
  const area = document.getElementById('areaResolucao');
  if (!modal || !area) return;

  area.innerHTML = `<p style="color:#666;">Carregando resolu√ß√£o...</p>`;

  const oldInstance = M.Modal.getInstance(modal);
  if (oldInstance) oldInstance.destroy();

  const teste = new Image();
  teste.onload = () => {
    area.innerHTML = `
      <div style="
        display:flex;
        justify-content:center;
        align-items:flex-start;
        overflow-y:auto;
        overflow-x:hidden;
        max-height:85vh;
        padding:10px;
        margin:0 auto;
        scrollbar-width:thin;
      ">
        <img src="${urlImagem}" alt="Resolu√ß√£o"
          style="
            width:100%;
            max-width:900px;
            height:auto;
            border-radius:10px;
            box-shadow:0 0 12px rgba(0,0,0,0.25);
            display:block;
          ">
      </div>
    `;
  };
  teste.onerror = () => {
    area.innerHTML = `
      <iframe src="${urlIframe}"
              style="width:95vw;height:85vh;border:none;border-radius:10px;background:#fff;"></iframe>
    `;
  };
  teste.src = urlImagem;

  // ‚öôÔ∏è Modal sem rolagem duplicada
  const instance = M.Modal.init(modal, {
    preventScrolling: true,
    dismissible: true,
    opacity: 0.6
  });

  instance.open();
}





  // === BOT√ÉO VOLTAR AO TOPO ===
  window.addEventListener("scroll", () => {
    const btn = document.getElementById("btnTopo");
    btn.style.display = (window.scrollY > 500) ? 'block' : 'none';
  });
  </script>
</body>
</html>
