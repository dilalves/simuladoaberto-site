<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/x-icon" href="https://www.curso-objetivo.br/assets/img/favicon.ico" />
  <title>Resultado - Simulado Fuvest√£o 2026</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">

  <style>
    header {
      margin:0;
      padding:20px 0;
      background:#002776;
      color:#fff;
      text-align:center;
    }
    body { background:#fafafa; }
    h1 { margin:0; font-size:24px; }
    footer { text-align:center; padding:20px; font-size:14px; color:#888; }
    .brand { color:#002776; font-weight:600; }
    table.striped th { color:#002776; }
    .acerto { background:#e8f5e9; }
    .erro { background:#ffebee; }
    .btn { border-radius:6px; }
    .card { border-radius:10px; }

    /* Resolu√ß√£o */
    #resolucaoContainer {
      display:none;
      margin-top:40px;
    }
    #resolucaoImagem {
      max-width:100%;
      border-radius:8px;
      box-shadow:0 0 8px rgba(0,0,0,0.2);
    }

    /* Bot√£o flutuante */
    #btnTopo {
      position:fixed;
      right:20px;
      bottom:20px;
      background:#002776;
      color:#fff;
      border:none;
      border-radius:50%;
      width:46px;
      height:46px;
      font-size:22px;
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
      display:none;
    }
    #btnTopo:hover {
      background:#0b49a5;
    }
  </style>
</head>

<body>

  <header>
    <h1>Simulado Aberto Fuvest√£o 2026</h1>
  </header>

  <img src="https://raw.githubusercontent.com/dilalves/simuladoaberto-site/main/resultadoenem0825/Digital---Simulado-Aberto-728X90.png" 
       alt="Banner Simulado Aberto"
       style="display:block; margin:20px auto; max-width:728px; width:100%;">

  <div class="container">
    <h5 class="brand center">Simulado Fuvest√£o 2025</h5>
    <div class="card z-depth-2" style="padding:20px;">
      <div class="row">
        <div class="input-field col s6">
          <input id="inscricao" type="text">
          <label for="inscricao">Inscri√ß√£o</label>
        </div>
        <div class="input-field col s6">
          <input id="cpf" type="text">
          <label for="cpf">CPF</label>
        </div>
      </div>
      <div class="center">
        <button class="btn waves-effect blue darken-3" onclick="buscarResultado()">Consultar Resultado</button>
      </div>
    </div>

    <div id="dadosAluno" class="card white z-depth-1" style="display:none; padding:20px;"></div>

    <table id="tblRespostas" class="striped centered responsive-table" style="display:none;">
      <thead>
        <tr>
          <th>Quest√£o</th>
          <th>Resposta Aluno</th>
          <th>Gabarito</th>
          <th>Resolu√ß√£o</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="resolucaoContainer" class="center-align">
      <h6 class="brand">Resolu√ß√£o da Quest√£o</h6>
      <img id="resolucaoImagem" src="" alt="Resolu√ß√£o">
    </div>

    <button id="btnTopo" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚Üë</button>
  </div>

  <script>
  async function buscarResultado() {
    const inscricao = document.getElementById("inscricao").value.trim();
    const cpf = document.getElementById("cpf").value.trim();
    const url = `https://api.secauxiliar.com.br/psq_resultado_fuv_0925.php?inscricao=${inscricao}&cpf=${cpf}`;

    try {
      const resp = await fetch(url);
      const dados = await resp.json();

      if (!dados.ok) {
        M.toast({html: dados.msg, classes: 'red'});
        return;
      }

      const aluno = dados.aluno;
      const respostas = dados.respostas;
      const dadosAluno = document.getElementById('dadosAluno');
      const tabela = document.getElementById('tblRespostas');
      const tbody = tabela.querySelector('tbody');

      // Cabe√ßalho com informa√ß√µes b√°sicas
      dadosAluno.innerHTML = `
        <h6><b>${aluno.Nome}</b> ‚Ä¢ ${aluno.Nome_Unidade}</h6>
        <p>Inscri√ß√£o: ${aluno.INSCRICAO} | CPF: ${aluno.CPF}</p>
        <p><b>Acertos:</b> ${dados.acertos}/${dados.total} (${dados.percentual}%)</p>
      `;
      dadosAluno.style.display = 'block';

      // Bloco de notas e classifica√ß√µes
      const notasHTML = `
        <table class="highlight centered">
          <thead>
            <tr><th colspan="13">Desempenho nas √Åreas</th></tr>
            <tr>
              <th>POR</th><th>HIS</th><th>ING</th><th>SOC</th>
              <th>BIO</th><th>QUI</th><th>FIL</th><th>FIS</th>
              <th>MAT</th><th>GEO</th><th>TOTAL</th><th>CLS_G</th><th>CLS_U</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${aluno.POR}</td><td>${aluno.HIS}</td><td>${aluno.ING}</td><td>${aluno.SOC}</td>
              <td>${aluno.BIO}</td><td>${aluno.QUI}</td><td>${aluno.FIL}</td><td>${aluno.FIS}</td>
              <td>${aluno.MAT}</td><td>${aluno.GEO}</td><td><b>${aluno.TOTAL}</b></td>
              <td>${aluno.CLS_G}</td><td>${aluno.CLS_U}</td>
            </tr>
          </tbody>
        </table>
      `;
      dadosAluno.innerHTML += notasHTML;

      // Filtra apenas as quest√µes erradas
      const erros = respostas.filter(r => r.RESPOSTA_ALUNO !== r.GABARITO_CORRETO);

      if (erros.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4">Parab√©ns! Nenhum erro encontrado üéâ</td></tr>`;
      } else {
        tbody.innerHTML = erros.map(r => `
          <tr class="erro">
            <td>${r.QUESTAO_ALUNO}</td>
            <td>${r.RESPOSTA_ALUNO}</td>
            <td>${r.GABARITO_CORRETO}</td>
            <td>
              ${r.LINK ? `<button class="btn-small blue lighten-1" onclick="mostrarResolucao('${r.LINK}')">Ver resolu√ß√£o</button>` : '-'}
            </td>
          </tr>
        `).join('');
      }

      tabela.style.display = 'table';
    } catch (e) {
      console.error(e);
      M.toast({html:'Erro ao consultar resultado', classes:'red'});
    }
  }

  function mostrarResolucao(link) {
    const container = document.getElementById("resolucaoContainer");
    const img = document.getElementById("resolucaoImagem");

    const match = link.match(/id=([^&]+)/);
    if (match) {
      const fileId = match[1];
      img.src = `https://drive.google.com/uc?export=view&id=${fileId}`;
      container.style.display = 'block';
      window.scrollTo({ top: container.offsetTop - 60, behavior: 'smooth' });
      document.getElementById("btnTopo").style.display = 'block';
    } else {
      alert("Link inv√°lido ou indispon√≠vel.");
    }
  }

  window.addEventListener("scroll", () => {
    const btn = document.getElementById("btnTopo");
    btn.style.display = (window.scrollY > 500) ? 'block' : 'none';
  });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>
</html>
